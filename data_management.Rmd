---
title: "VN Elite Network - Data Management"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(stringr)
library(tidyverse)
library(dplyr)
library(igraph)
library(ggplot2)
```

```{r}
d <- rio::import(here::here("data", "po_gov.xlsx")) %>% 
  mutate(person_name = str_to_lower(person_name), 
         hometown = str_to_lower(hometown)) %>% 
  mutate(branch = ifelse(str_detect(seatID, "pol"), "Politburo", "Government")
         ) %>%  # pol = 1, gov = 0
select(-c(year_birth, enter_party))

saveRDS(d, "elite_data.RDS")
```

# Overall 
```{r}

 d %>% 
  add_count(hometown) %>% arrange(desc(n)) %>% drop_na(hometown) %>% 
  mutate(hometown = fct_reorder(hometown, n)) %>% 
  filter(n >= 5) %>% 
  
ggplot(aes(hometown)) +
 geom_bar(fill="#69b3a2", alpha=.8, width=.4) +
  coord_flip() +
  #facet_wrap(~branch)+
  labs(
    x = "",
    y= "Count of seats",
    title = "Hometowns fill at least 5 seats in the Politburo and the Government",
    subtitle = "Years: 2001 ~ 2026"
  ) +
  theme_minimal()

# highlight region 
 # south <- d %>% 
 #  add_count(hometown) %>% arrange(desc(n)) %>% drop_na(hometown) %>% 
 #  mutate(hometown = fct_reorder(hometown, n)) %>% 
 #  filter(hometown %in% c("quang nam", "ca mau", "ben tre", "long an", "tra vinh", "dong thap"))
  
```
# Seats by branches

```{r}
d %>% 
  add_count(hometown) %>% arrange(desc(n)) %>% drop_na(hometown) %>% 
  mutate(hometown = fct_reorder(hometown, n)) %>% 
  filter(n >= 5) %>% 
ggplot(aes(hometown)) +
 geom_bar(fill="tomato", alpha=.6, width=.4) +
  coord_flip() +
  facet_wrap(~branch)+
  labs(
    x = "",
    y= "Count of seats",
    title = "Hometowns fill more than 5 seats in each branch",
    subtitle = "Years: 2001 ~ 2026"
  )  +
  theme_minimal()
```
# Five hometowns by terms

```{r}
d %>% 
  group_by(term_serve) %>% 
  add_count(hometown) %>% arrange(desc(n)) %>% drop_na(hometown) %>% 
  mutate(hometown = fct_reorder(hometown, n)) %>% 
  filter(hometown %in% c("ha noi", "nam dinh", "nghe an", "ha tinh", "thanh hoa")) %>% 
  select(term_serve, n, hometown) %>% distinct() %>% 
  
  ggplot(aes(term_serve, n, group = hometown)) +
  geom_line(aes(color = hometown), size = 1.5) +
  labs(
    title = "Change in number of seats per hometown across 5 terms",
    x = "Term",
    y = "Count of seats",
  ) +
scale_color_brewer(palette="Paired") +
  theme_minimal()
```
# Five hometowns across term by branches 

```{r}
d %>% 
  group_by(term_serve) %>% 
  add_count(hometown) %>% arrange(desc(n)) %>% drop_na(hometown) %>% 
  mutate(hometown = fct_reorder(hometown, n)) %>% 
  filter(hometown %in% c("ha noi", "nam dinh", "nghe an", "ha tinh", "thanh hoa")) %>% 
  select(term_serve, n, hometown, branch) %>% distinct() %>% 
  
  ggplot(aes(term_serve, n, group = hometown)) +
  geom_line(aes(color = hometown), size = 1.5) +
  facet_wrap(~branch) +
  labs(
    title = "Change in number of seats per hometown across 5 terms",
    x = "Term",
    y = "Count of seats",
  ) +
scale_color_brewer(palette="Paired") +
  theme_minimal()
```

# Proportion of seat per term
```{r}
d_ggplot %>% 
  group_by(term_serve) %>% 
  add_count(hometown)
  mutate(hometown_prop = )
  
   d %>% 
  drop_na(hometown) %>% 
  group_by(term_serve, branch) %>% 
  add_count(term_serve) %>% 
  rename(seat_per_branch_term = n) %>% 
     ungroup() %>% 
     group_by(term_serve, branch) %>% 
     add_count(hometown) %>% 
     mutate(prop_hometown_seat = n/seat_per_branch_term)  

   
ggplot(aes(hometown, prop_hometown_seat)) +
 geom_col(fill="#69b3a2", alpha=.8, width=.4) +
  coord_flip() +
  facet_wrap(~term_serve)+
  labs(
    x = "",
    y= "Prop of seats",
    title = "Hometowns ...",
    subtitle = ""
  )  +
  theme_minimal()
```


